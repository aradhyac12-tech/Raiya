<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Valentine Experience</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.createjs.com/1.0.0/easeljs.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@200;300;400;500&family=Playfair+Display:ital,wght@1,400;1,600&family=Gotu&family=Share+Tech+Mono&display=swap');

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background-color: #000000; color: #ffffff; overflow-x: hidden; font-family: 'Inter', sans-serif; }

        /* Layers */
        /* App is always on top (z-20) but lets clicks pass through empty areas */
        #app { position: relative; z-index: 20; min-height: 100vh; pointer-events: none; }
        
        /* Backgrounds & Models */
        .model-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 5; opacity: 0; transition: opacity 1s; pointer-events: auto; }
        .model-active { opacity: 1; }
        
        #canvas-infinite { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; pointer-events: none; opacity: 0; background: #000; transition: opacity 1s; }
        #canvas-fireworks { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 15; pointer-events: none; }
        
        /* BPM Monitor */
        #bpm-display {
            position: fixed; top: 20px; right: 20px; z-index: 60;
            font-family: 'Share Tech Mono', monospace;
            color: #ef4444; text-shadow: 0 0 10px rgba(239, 68, 68, 0.6);
            display: flex; align-items: center; gap: 8px;
            opacity: 0; transition: opacity 1s;
        }
        .heart-icon { width: 20px; animation: beat 1s infinite; }

        /* Sketchfab */
        .iframe-wrapper { width: 100%; height: 120%; transform: translateY(-10%); }
        iframe { width: 100%; height: 100%; border: none; }

        /* UI */
        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
        }
        .glass-button {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            cursor: pointer;
            pointer-events: auto; /* Ensures buttons are always clickable */
        }
        .glass-button:active { transform: scale(0.95); background: rgba(255, 255, 255, 0.2); }

        /* Scroller */
        .picker-wrapper {
            position: relative; height: 180px; width: 80px; overflow: hidden;
            mask-image: linear-gradient(to bottom, transparent, black 15%, black 85%, transparent);
            -webkit-mask-image: linear-gradient(to bottom, transparent, black 15%, black 85%, transparent);
            pointer-events: auto;
        }
        .picker-scroller { height: 100%; overflow-y: scroll; scroll-snap-type: y mandatory; scroll-behavior: smooth; padding-right: 20px; box-sizing: content-box; width: 100%; }
        .picker-item { height: 45px; display: flex; align-items: center; justify-content: center; scroll-snap-align: center; font-size: 1.4rem; color: rgba(255,255,255,0.3); transition: transform 0.1s linear, opacity 0.1s linear; }
        .picker-item.active { color: #fff; font-size: 1.6rem; font-weight: 600; text-shadow: 0 0 10px rgba(255,255,255,0.5); }
        .picker-highlight { position: absolute; top: 50%; left: 0; width: 100%; height: 45px; transform: translateY(-50%); border-top: 1px solid rgba(255,255,255,0.15); border-bottom: 1px solid rgba(255,255,255,0.15); pointer-events: none; }

        /* Animations */
        @keyframes fade-up { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-up { animation: fade-up 0.8s ease-out forwards; opacity: 0; }
        .marathi-text { font-family: 'Gotu', sans-serif; line-height: 1.8; }
        
        @keyframes beat {
            0% { transform: scale(1); }
            15% { transform: scale(1.15); }
            30% { transform: scale(1); }
            45% { transform: scale(1.15); }
            60% { transform: scale(1); }
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .bounce-arrow { animation: bounce 2s ease-in-out infinite; }
        
        .adrenaline-effect .iframe-wrapper { animation: beat 0.3s infinite; }
        
        /* Helper to ensure specific elements capture clicks */
        .pointer-auto { pointer-events: auto; }
        .pointer-none { pointer-events: none; }

    </style>
</head>
<body class="bg-black text-white">

    <div id="bpm-display">
        <svg class="heart-icon" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
        </svg>
        <span class="text-xl tracking-widest"><span id="bpm-val">72</span> BPM</span>
    </div>

    <div id="model-heart" class="model-container">
        <div class="iframe-wrapper">
            <iframe title="Human Heart" frameborder="0" allowfullscreen mozallowfullscreen="true" webkitallowfullscreen="true" allow="autoplay; fullscreen; xr-spatial-tracking" xr-spatial-tracking execution-while-out-of-viewport execution-while-not-rendered web-share src="https://sketchfab.com/models/775d6629622740de8a5ed61a959c7506/embed?autostart=1&ui_theme=dark&dnt=1"></iframe>
        </div>
    </div>

    <div id="model-rose" class="model-container">
        <div class="iframe-wrapper">
            <iframe title="Rose" frameborder="0" allowfullscreen mozallowfullscreen="true" webkitallowfullscreen="true" allow="autoplay; fullscreen; xr-spatial-tracking" xr-spatial-tracking execution-while-out-of-viewport execution-while-not-rendered web-share src="https://sketchfab.com/models/6281bf3703584323bb4d8326f1f1b59d/embed?autostart=1&ui_theme=dark&dnt=1"></iframe>
        </div>
    </div>

    <canvas id="canvas-infinite"></canvas>
    <canvas id="canvas-fireworks"></canvas>

    <div id="app"></div>

    <script type="module">
        // ================= STATE =================
        const state = {
            page: 0,
            password: '0102', 
            correctMet: { d: 13, m: 10, y: 2025 }, 
            correctProp: { d: 20, m: 12, y: 2025 }, 
            sel1: { d: 1, m: 1, y: 2020 },
            sel2: { d: 1, m: 1, y: 2020 },
            eyesShown: false,
            yesBtnSize: 1,
            noMsgIdx: 0,
            noMessages: ["Are you sure?", "Really sure??", "Pretty please?", "Don't do this!", "Think again!", "I'll be sad...", "Pookie please ðŸ¥º"],
            currentBpm: 70,
            targetBpm: 70
        };

        const audio = {
            bg: new Audio('assets/song.mp3'),
            heart: new Audio('assets/song2.mp3')
        };

        // ================= BPM LOGIC =================
        const updateBPM = () => {
            const diff = state.targetBpm - state.currentBpm;
            if (Math.abs(diff) > 0.5) {
                state.currentBpm += diff * 0.05; 
            } else {
                state.currentBpm = state.targetBpm;
                if(Math.random() > 0.8) state.currentBpm += (Math.random() - 0.5) * 2;
            }
            
            const el = document.getElementById('bpm-val');
            if(el) el.innerText = Math.round(state.currentBpm);
            
            const dur = 60 / state.currentBpm;
            document.querySelector('.heart-icon').style.animationDuration = `${dur}s`;
            
            requestAnimationFrame(updateBPM);
        };
        requestAnimationFrame(updateBPM);

        // ================= AUDIO LOGIC =================
        const initAudio = () => {
            audio.bg.loop = true; audio.bg.volume = 0.5;
            audio.heart.loop = true; audio.heart.volume = 0;
            audio.bg.play().catch(e => console.log("Audio waiting..."));
            audio.heart.play().then(() => audio.heart.pause());
        };

        const switchAudioToHeart = () => {
            let vol = audio.bg.volume;
            const fadeOut = setInterval(() => {
                if (vol > 0.05) {
                    vol -= 0.05;
                    audio.bg.volume = vol;
                } else {
                    clearInterval(fadeOut);
                    audio.bg.pause(); 
                    audio.heart.volume = 1.0;
                    audio.heart.play();
                }
            }, 50);
        };

        const switchAudioToBg = () => {
            audio.heart.pause();
            audio.bg.play(); 
            let vol = 0;
            const fadeIn = setInterval(() => {
                if (vol < 0.5) {
                    vol += 0.05;
                    audio.bg.volume = vol;
                } else {
                    clearInterval(fadeIn);
                }
            }, 100);
        };

        // ================= INFINITE HEARTS =================
        let infiniteStage, infiniteContainer, captureContainers, captureIndex;
        
        const initInfiniteHearts = () => {
            const canvas = document.getElementById("canvas-infinite");
            canvas.style.opacity = '1';
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            infiniteStage = new createjs.Stage(canvas);
            infiniteContainer = new createjs.Container();
            infiniteStage.addChild(infiniteContainer);
            
            captureContainers = [];
            captureIndex = 0;

            for (let i = 0; i < 60; i++) {
                let heart = new createjs.Shape();
                heart.graphics.beginFill(createjs.Graphics.getHSL(Math.random() * 30 - 45, 100, 50 + Math.random() * 30));
                heart.graphics.moveTo(0, -12).curveTo(1, -20, 8, -20).curveTo(16, -20, 16, -10).curveTo(16, 0, 0, 12);
                heart.graphics.curveTo(-16, 0, -16, -10).curveTo(-16, -20, -8, -20).curveTo(-1, -20, 0, -12);
                heart.y = -100;
                infiniteContainer.addChild(heart);
            }

            for (let i = 0; i < 10; i++) { 
                let c = new createjs.Container();
                c.cache(0, 0, canvas.width, canvas.height);
                captureContainers.push(c);
            }

            createjs.Ticker.timingMode = createjs.Ticker.RAF;
            createjs.Ticker.on("tick", tickInfinite);
        };

        const tickInfinite = (event) => {
            if(state.page !== 3 && state.page !== 9) return; 
            
            const w = window.innerWidth;
            const h = window.innerHeight;
            const l = infiniteContainer.numChildren;

            captureIndex = (captureIndex + 1) % captureContainers.length;
            infiniteStage.removeChildAt(0);
            let captureContainer = captureContainers[captureIndex];
            infiniteStage.addChildAt(captureContainer, 0);
            captureContainer.addChild(infiniteContainer);

            for (let i = 0; i < l; i++) {
                let heart = infiniteContainer.getChildAt(i);
                if (heart.y < -50) {
                    heart._x = Math.random() * w;
                    heart.y = h * (1 + Math.random()) + 50;
                    heart.perX = (1 + Math.random() * 2) * h;
                    heart.offX = Math.random() * h;
                    heart.ampX = heart.perX * 0.1 * (0.15 + Math.random());
                    heart.velY = -Math.random() * 2 - 1;
                    heart.scale = Math.random() * 2 + 1;
                    heart._rotation = Math.random() * 40 - 20;
                    heart.alpha = Math.random() * 0.75 + 0.05;
                    heart.compositeOperation = Math.random() < 0.33 ? "lighter" : "source-over";
                }
                let int = (heart.offX + heart.y) / heart.perX * Math.PI * 2;
                heart.y += heart.velY * heart.scaleX / 2;
                heart.x = heart._x + Math.cos(int) * heart.ampX;
                heart.rotation = heart._rotation + Math.sin(int) * 30;
            }
            captureContainer.updateCache("source-over");
            infiniteStage.update(event);
        };

        const stopInfiniteHearts = () => {
             document.getElementById("canvas-infinite").style.opacity = '0';
        };

        // ================= FIREWORKS =================
        const triggerFireworks = () => {
            const canvas = document.getElementById('canvas-fireworks');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            const ctx = canvas.getContext('2d');
            const particles = [];

            class Particle {
                constructor(x, y, color) {
                    this.x = x; this.y = y; this.color = color;
                    this.velocity = { x: (Math.random() - 0.5) * 10, y: (Math.random() - 0.5) * 10 };
                    this.alpha = 1; this.friction = 0.96;
                }
                draw() {
                    ctx.globalAlpha = this.alpha;
                    ctx.fillStyle = this.color;
                    ctx.fillRect(this.x, this.y, 2, 2);
                }
                update() {
                    this.velocity.x *= this.friction;
                    this.velocity.y *= this.friction;
                    this.velocity.y += 0.1; // gravity
                    this.x += this.velocity.x;
                    this.y += this.velocity.y;
                    this.alpha -= 0.015;
                }
            }

            const animateFW = () => {
                if(state.page !== 8) {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    return;
                }
                requestAnimationFrame(animateFW);
                ctx.fillStyle = 'rgba(0, 0, 0, 0.15)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                particles.forEach((p, i) => {
                    if (p.alpha > 0) { p.update(); p.draw(); } else particles.splice(i, 1);
                });
            };
            animateFW();

            const launch = () => {
                if(state.page !== 8) return;
                const x = Math.random() * canvas.width;
                const y = Math.random() * canvas.height * 0.5;
                const color = `hsl(${Math.random() * 360}, 70%, 60%)`;
                for (let i = 0; i < 40; i++) particles.push(new Particle(x, y, color));
                setTimeout(launch, 800);
            }
            launch();
        };

        // ================= SCROLLER =================
        const createPicker = (id, min, max, type, pageNum) => {
            const range = max - min + 1;
            const startVal = min + Math.floor(Math.random() * range); 
            if(pageNum === 1) state.sel1[type] = startVal; else state.sel2[type] = startVal;
            setTimeout(() => initPickerLogic(id, min, max, startVal, type, pageNum), 50);
            return `<div class="picker-wrapper glass rounded-xl pointer-auto"><div class="picker-highlight"></div><div id="${id}" class="picker-scroller scrollbar-hide"><div style="height: 67px;"></div>${Array.from({length: max-min+1}, (_, i) => `<div class="picker-item" data-val="${min+i}">${min+i}</div>`).join('')}<div style="height: 67px;"></div></div></div>`;
        };

        const initPickerLogic = (id, min, max, startVal, type, pageNum) => {
            const el = document.getElementById(id);
            const items = el.querySelectorAll('.picker-item');
            const itemH = 45;
            el.scrollTop = (startVal - min) * itemH;
            updateVisuals(el, startVal - min, items);

            let isScrolling;
            el.addEventListener('scroll', () => {
                window.cancelAnimationFrame(isScrolling);
                isScrolling = window.requestAnimationFrame(() => {
                    const idx = Math.round(el.scrollTop / itemH);
                    if(idx >= 0 && idx < items.length) {
                        const val = parseInt(items[idx].dataset.val);
                        if(pageNum === 1) state.sel1[type] = val; else state.sel2[type] = val;
                        updateVisuals(el, idx, items);
                    }
                });
            });
        };

        const updateVisuals = (container, activeIdx, items) => {
            items.forEach((item, idx) => {
                const dist = Math.abs(idx - activeIdx);
                if(dist === 0) {
                    item.classList.add('active'); item.style.transform = `scale(1.1) translateZ(0)`; item.style.opacity = '1';
                } else if(dist === 1) {
                    item.classList.remove('active'); item.style.transform = `scale(0.9) rotateX(${idx > activeIdx ? '-25deg' : '25deg'}) translateZ(0)`; item.style.opacity = '0.5';
                } else {
                    item.classList.remove('active'); item.style.transform = `scale(0.8) translateZ(0)`; item.style.opacity = '0.2';
                }
            });
        };

        // ================= APP LOGIC =================
        window.checkPass = () => {
            if(document.getElementById('passInput').value === state.password) {
                initAudio();
                transition(1);
            } else {
                if(navigator.vibrate) navigator.vibrate([50,50]);
                const el = document.getElementById('passInput');
                el.style.borderColor = '#ef4444';
                setTimeout(()=>el.style.borderColor='rgba(255,255,255,0.2)', 500);
            }
        };

        window.validateDate = (pg) => {
            const sel = pg === 1 ? state.sel1 : state.sel2;
            const cor = pg === 1 ? state.correctMet : state.correctProp;
            if(sel.d === cor.d && sel.m === cor.m && sel.y === cor.y) transition(pg + 1);
            else { if(navigator.vibrate) navigator.vibrate(200); alert("Think harder... â¤ï¸"); }
        };

        window.handleNo = () => {
            state.yesBtnSize += 0.5; state.noMsgIdx++; render();
        };

        window.handleYes = () => {
             transition(8);
        };

        window.transition = (pg) => {
            const app = document.getElementById('app');
            app.style.opacity = '0';
            setTimeout(() => {
                state.page = pg;
                render();
                app.style.opacity = '1';
                handleSideEffects(pg);
            }, 500);
        };

        const handleSideEffects = (pg) => {
            const heartModel = document.getElementById('model-heart');
            const roseModel = document.getElementById('model-rose');
            const bpmDisplay = document.getElementById('bpm-display');
            
            bpmDisplay.style.opacity = '0';
            
            heartModel.classList.remove('model-active', 'adrenaline-effect');
            roseModel.classList.remove('model-active');
            stopInfiniteHearts();
            
            if(pg < 4) state.targetBpm = 75;

            if(pg === 3) initInfiniteHearts();

            if(pg === 4) {
                bpmDisplay.style.opacity = '1';
                heartModel.classList.add('model-active');
                state.targetBpm = 110; 
                setTimeout(() => {
                    state.eyesShown = true;
                    render();
                    setTimeout(() => {
                        switchAudioToHeart();
                        state.targetBpm = 145; 
                        heartModel.classList.add('adrenaline-effect');
                        if(navigator.vibrate) navigator.vibrate([100, 50, 100, 50, 100]);
                        document.getElementById('nextBtn4').classList.remove('opacity-0');
                    }, 1500);
                }, 4000);
            } 
            
            if(pg === 5) {
                switchAudioToBg();
                state.targetBpm = 95; 
                heartModel.classList.add('model-active'); 
                heartModel.style.opacity = '0.1';
                typeWriter();
            }

            if(pg === 6) {
                state.targetBpm = 100;
                roseModel.classList.add('model-active'); 
            }

            if(pg === 7) {
                 state.targetBpm = 120;
            }

            if(pg === 8) {
                state.targetBpm = 160; 
                triggerFireworks();
                setTimeout(() => transition(9), 4000);
            }

            if(pg === 9) {
                initInfiniteHearts();
                state.targetBpm = 80; 
                setTimeout(() => transition(0), 6000);
            }
        };

        const typeWriter = () => {
            const text = `à¤•à¥à¤ à¥‡ à¤°à¤¾à¤¹à¤¤à¥‡ à¤¸à¥à¤‚à¤¦à¤°à¤¤à¤¾ à¤…à¤¸à¤‚ à¤®à¤²à¤¾ à¤µà¤¿à¤šà¤¾à¤°à¤²à¤‚ à¤à¤•à¤¾à¤¨à¥‡, à¤¦à¥à¤¸à¤±à¥à¤¯à¤¾à¤¨à¥‡à¤¹à¥€ à¤¤à¥‡à¤š à¤µà¤¿à¤šà¤¾à¤°à¤²à¤‚.\nà¤®à¥€ à¤®à¥à¤¹à¤Ÿà¤² - "à¤•à¤¶à¥€ à¤¦à¤¿à¤¸à¤¤à¥‡ à¤¤à¥à¤®à¥à¤¹à¥€ à¤¸à¤¾à¤‚à¤—à¤¾ à¤¤à¤°."\nà¤¦à¥‹à¤¨ à¤¤à¤¾à¤¸ à¤¤à¥à¤¯à¤¾à¤¨à¥‡ à¤«à¤•à¥à¤¤ à¤¤à¤¾à¤°à¥€à¤«à¤š à¤•à¥‡à¤²à¥€,\nà¤¨à¤‚à¤¤à¤° à¤•à¤³à¤²à¤‚...\nà¤¤à¥‡ à¤¤à¤° à¤¤à¥‚à¤š à¤¹à¥‹à¤¤à¥€à¤¸ à¤µà¥‡à¤¡à¥€.`;
            const el = document.getElementById('marathi-text');
            if(!el) return;
            let i = 0;
            const type = () => {
                if(i < text.length) {
                    el.innerHTML += text.charAt(i) === '\n' ? '<br/>' : text.charAt(i);
                    i++;
                    setTimeout(type, 50);
                } else {
                    document.getElementById('marathi-btn').classList.remove('opacity-0');
                }
            };
            type();
        };

        // ================= RENDER =================
        window.render = () => {
            const app = document.getElementById('app');
            let html = '';

            // 0. LOCK
            if(state.page === 0) {
                html = `
                    <div class="min-h-screen flex flex-col items-center justify-center p-6 pointer-auto">
                        <div class="glass p-8 rounded-3xl flex flex-col items-center animate-fade-up">
                            <h2 class="text-xs tracking-[0.4em] uppercase text-white/50 mb-8">Passcode</h2>
                            <input type="password" id="passInput" maxlength="4" class="bg-transparent border-b border-white/20 w-32 text-center text-3xl tracking-[0.5em] focus:outline-none focus:border-white mb-10 pb-2 text-white placeholder-white/10" placeholder="â€¢â€¢â€¢â€¢">
                            <button onclick="checkPass()" class="glass-button w-full py-4 rounded-xl text-xs uppercase tracking-widest text-white/80">Unlock</button>
                        </div>
                    </div>`;
            }

            // 1 & 2. DATES
            else if(state.page === 1 || state.page === 2) {
                html = `
                    <div class="min-h-screen flex flex-col items-center justify-center relative z-20 pointer-auto">
                        <h2 class="text-3xl font-light text-stone-200 mb-12 animate-fade-up">${state.page === 1 ? 'When did we meet?' : 'When did I propose?'}</h2>
                        <div class="flex gap-4 mb-12 animate-fade-up delay-100">
                            ${createPicker(`p${state.page}_d`, 1, 31, 'd', state.page)}
                            ${createPicker(`p${state.page}_m`, 1, 12, 'm', state.page)}
                            ${createPicker(`p${state.page}_y`, 2020, 2026, 'y', state.page)}
                        </div>
                        <button onclick="validateDate(${state.page})" class="glass-button p-4 rounded-full animate-fade-up delay-200">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
                        </button>
                    </div>`;
            }

            // 3. NAME REVEAL
            else if(state.page === 3) {
                html = `
                    <div class="min-h-screen flex flex-col items-center justify-center relative z-20 pointer-auto">
                        <h1 class="text-7xl md:text-9xl font-thin tracking-[0.2em] animate-fade-up drop-shadow-2xl">RAIYA</h1>
                        <button onclick="transition(4)" class="mt-20 glass-button px-8 py-3 rounded-full opacity-60 hover:opacity-100 transition-opacity">Proceed</button>
                    </div>`;
            }

            // 4. EYES & HEART
            else if(state.page === 4) {
                html = `
                    <div class="min-h-screen flex flex-col items-center justify-center pointer-none">
                        ${state.eyesShown ? `
                            <div class="animate-fade-up flex flex-col items-center mb-24 z-30 pointer-auto">
                                <div class="relative">
                                    <img src="assets/eyes.jpg" class="w-72 rounded-2xl shadow-[0_0_50px_rgba(220,38,38,0.5)] border border-white/10 relative z-10">
                                    <div class="absolute inset-0 bg-red-500/20 blur-xl animate-pulse"></div>
                                </div>
                                <p class="mt-8 text-3xl font-serif text-rose-200 italic drop-shadow-lg text-center">When I see your eyes...<br><span class="text-lg text-white/70 font-sans not-italic mt-2 block">The adrenaline kicks in</span></p>
                            </div>
                        ` : ''}
                        <button id="nextBtn4" onclick="transition(5)" class="pointer-auto absolute bottom-12 glass-button px-8 py-3 rounded-full opacity-0 transition-opacity duration-1000 z-30">Next</button>
                    </div>`;
            }

            // 5. MARATHI SHAYARI
            else if(state.page === 5) {
                html = `
                    <div class="min-h-screen flex flex-col items-center justify-center px-6 relative z-20 pointer-none">
                        <div class="glass p-8 rounded-2xl max-w-lg w-full min-h-[300px] flex flex-col justify-center pointer-auto">
                            <p id="marathi-text" class="marathi-text text-xl md:text-2xl text-stone-200 leading-relaxed"></p>
                        </div>
                        <button id="marathi-btn" onclick="transition(6)" class="mt-8 glass-button px-8 py-3 rounded-full opacity-0 transition-opacity duration-500 pointer-auto">
                             <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"/></svg>
                        </button>
                    </div>`;
            }

            // 6. ROSE PAGE (FIXED Z-INDEX LAYOUT)
            else if(state.page === 6) {
                html = `
                     <div class="min-h-screen flex flex-col items-center justify-between py-12 px-6 pointer-none">
                        <div class="glass p-6 rounded-xl animate-fade-up text-center pointer-auto mt-12 backdrop-blur-md">
                            <h2 class="text-3xl font-serif text-rose-300 mb-2">Happy Rose Day! ðŸŒ¹</h2>
                            <p class="text-white/70 text-lg">Mere fool. (You can rotate the rose)</p>
                        </div>
                        
                        <div class="w-full flex flex-col items-center pointer-auto mb-10">
                            <button onclick="transition(7)" class="glass-button px-10 py-4 rounded-full animate-fade-up delay-300 text-lg flex items-center gap-3 hover:bg-rose-500/20 group transition-all">
                                 <span>Accept this Rose</span>
                                 <svg class="w-5 h-5 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"/></svg>
                            </button>
                        </div>
                    </div>
                `;
            }

            // 7. PROPOSAL
            else if(state.page === 7) {
                const noText = state.noMessages[state.noMsgIdx % state.noMessages.length];
                const yesScale = 1 + (state.yesBtnSize * 0.2);
                
                html = `
                    <div class="min-h-screen flex flex-col items-center justify-center text-center px-4 relative z-20 pointer-auto">
                        <h1 class="text-4xl md:text-5xl font-serif leading-tight text-stone-100 mb-12 animate-fade-up">Will you be my Valentine?</h1>
                        <img src="https://media1.giphy.com/media/v1.Y2lkPTc5MGI3NjExbW5lenZyZHI5OXM2eW95b3pmMG40cWVrMDhtNjVuM3A4dGNxa2g2dSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9cw/VM1fcpu2bKs1e2Kdbj/giphy.gif" class="w-48 rounded-xl opacity-90 mb-12 animate-fade-up delay-100">
                        <div class="flex flex-wrap justify-center gap-6 animate-fade-up delay-200 items-center">
                             <button onclick="handleYes()" style="transform: scale(${yesScale})" class="glass-button bg-rose-500/20 border-rose-500/40 text-rose-100 px-10 py-4 rounded-full text-xl hover:bg-rose-500/30 transition-all duration-300">Yes</button>
                             <button onclick="handleNo()" class="glass-button px-6 py-4 rounded-full text-white/40 hover:text-white transition-all">${noText}</button>
                        </div>
                    </div>`;
            }

            // 8. I KNEW IT
            else if(state.page === 8) {
                html = `
                    <div class="min-h-screen flex flex-col items-center justify-center text-center px-4 relative z-20 pointer-auto">
                         <h1 class="text-5xl md:text-7xl font-serif text-rose-500 mb-6 animate-fade-up drop-shadow-[0_0_35px_rgba(220,38,38,0.9)]">I Knew it...!</h1>
                         <div class="w-64 h-64 rounded-full overflow-hidden border-4 border-white/10 mb-8 animate-fade-up delay-200 mx-auto shadow-[0_0_50px_rgba(255,255,255,0.1)]">
                            <img src="https://media.giphy.com/media/l0HlP2ms0eUc5nlHG/giphy.gif" class="w-full h-full object-cover opacity-80 scale-125">
                        </div>
                    </div>`;
            }

            // 9. FINAL QUOTE
            else if(state.page === 9) {
                html = `
                    <div class="min-h-screen flex flex-col items-center justify-center text-center px-4 relative z-20 pointer-auto">
                        <h2 class="text-2xl md:text-3xl font-light text-white mb-4 animate-fade-up px-4 leading-relaxed">I want to love you<br>as you wanted to be loved...!<br>ðŸ«€ðŸ¤ž</h2>
                        <div class="mt-12 text-xs text-white/30 animate-pulse font-mono">locking in 6s...</div>
                    </div>`;
            }

            app.innerHTML = html;
        };

        window.onload = () => { render(); };

    </script>
</body>
</html>
