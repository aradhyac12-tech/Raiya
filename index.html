<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#000000">
    <title>Valentine's Experience</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.createjs.com/1.0.0/easeljs.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@200;300;400;500&family=Playfair+Display:ital,wght@1,400;1,500&display=swap');

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background-color: #000000; color: #ffffff; overflow-x: hidden; font-family: 'Inter', sans-serif; }
        
        /* Hide Scrollbar */
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Glassmorphism */
        .glass {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
        }
        
        .glass-button {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .glass-button:active { transform: scale(0.95); background: rgba(255, 255, 255, 0.1); }

        /* iOS Picker Styles */
        .picker-container {
            height: 200px;
            overflow-y: scroll;
            scroll-snap-type: y mandatory;
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
            mask-image: linear-gradient(to bottom, transparent, black 20%, black 80%, transparent);
            -webkit-mask-image: linear-gradient(to bottom, transparent, black 20%, black 80%, transparent);
        }
        .picker-item {
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            scroll-snap-align: center;
            transition: all 0.2s ease;
        }

        /* Animations */
        @keyframes fade-in-up { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in-up { animation: fade-in-up 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; opacity: 0; }
        
        @keyframes pulse-slow { 0%, 100% { transform: scale(1); opacity: 0.8; } 50% { transform: scale(1.05); opacity: 1; } }
        .animate-pulse-slow { animation: pulse-slow 3s infinite ease-in-out; }

        .poetic-text { font-family: 'Playfair Display', serif; text-shadow: 0 0 20px rgba(255, 255, 255, 0.2); }
        
        /* Canvas Layers */
        #heartsCanvas, #fireworksCanvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; }
        #app { position: relative; z-index: 10; min-height: 100vh; }
    </style>
</head>
<body class="bg-black text-white">
    <div id="app"></div>

    <script type="module">
        import * as THREE from 'https://cdn.skypack.dev/three@0.136.0';
        import { FBXLoader } from 'https://cdn.skypack.dev/three@0.136.0/examples/jsm/loaders/FBXLoader.js';
        import { OrbitControls } from 'https://cdn.skypack.dev/three@0.136.0/examples/jsm/controls/OrbitControls.js';

        // ==================== STATE ====================
        const state = {
            page: 0,
            password: '',
            bpm: 72,
            metDate: { day: 13, month: 10, year: 2025 },
            proposeDate: { day: 20, month: 12, year: 2025 },
            // Make sure these match your correct answers:
            correctMet: { day: 13, month: 10, year: 2025 },
            correctProp: { day: 20, month: 12, year: 2025 },
            shayariText: '',
            currentLine: 0,
            currentChar: 0,
            yesBtnSize: 1,
            noMsgIdx: 0
        };

        const noMessages = ["Are you sure?", "Really?", "Pookie please...", "Don't do this", "Just say yes!", "I'm sad now :("];
        const shayariLines = [
            "Teach me how to love you", "because i wanna love you", "the way you want to be loved.", "",
            "I didn't need a reason to love you,", "and that's how I knew it was real.", "", "~ for my Raiya"
        ];

        let audio1, audio2, heartInterval;

        // ==================== UTILS ====================
        const haptic = (type) => {
            if (navigator.vibrate) {
                if (type === 'light') navigator.vibrate(5); // iOS-like tick
                if (type === 'medium') navigator.vibrate(15);
                if (type === 'heavy') navigator.vibrate(40);
                if (type === 'success') navigator.vibrate([10, 30, 10, 30]);
            }
        };

        const initAudio = () => {
            audio1 = new Audio('assets/song.mp3'); // Ensure these files exist
            audio1.loop = true; audio1.volume = 0.5;
            audio2 = new Audio('assets/song2.mp3');
            audio2.loop = true; audio2.volume = 0.5;
        };

        // ==================== NAVIGATION ====================
        window.transition = (newPage) => {
            haptic('light');
            const el = document.getElementById('main-content');
            if(el) {
                el.style.opacity = '0';
                el.style.transform = 'scale(0.98)';
            }
            setTimeout(() => {
                state.page = newPage;
                render();
                handlePageLogic(newPage);
            }, 300);
        };

        const handlePageLogic = (page) => {
            if (heartInterval) clearInterval(heartInterval);
            
            // Audio Logic
            if (page === 4 && audio1) audio1.play().catch(()=>{});
            if (page === 5 && audio1) { audio1.pause(); if(audio2) audio2.play().catch(()=>{}); }

            // 3D Heart Logic
            if (page === 4) initHeart(false, 'heartContainer');
            if (page === 5) {
                initHeart(true, 'heartContainer2');
                let bpm = 72;
                heartInterval = setInterval(() => {
                    bpm = Math.min(bpm + 0.5, 130);
                    state.bpm = Math.round(bpm);
                    const el = document.getElementById('bpm-display');
                    if(el) el.innerText = state.bpm;
                }, 100);
            }

            // Canvas Logic
            if (page === 6) initInfiniteHearts();
            if (page === 8) initFireworks();
            if (page === 10) typeWriter();
        };

        // ==================== PICKER LOGIC (iOS STYLE) ====================
        const setupPicker = (id, range, type, initial) => {
            const container = document.getElementById(id);
            if (!container) return;

            // Generate items
            let html = '<div class="h-[75px]"></div>'; // Top Spacer
            for (let i = range[0]; i <= range[1]; i++) {
                html += `<div class="picker-item text-3xl font-light text-white/30" data-val="${i}">${i}</div>`;
            }
            html += '<div class="h-[75px]"></div>'; // Bottom Spacer
            container.innerHTML = html;

            // Scroll to initial
            setTimeout(() => {
                const items = container.querySelectorAll('.picker-item');
                const index = initial - range[0];
                if(items[index]) items[index].scrollIntoView({ block: 'center' });
            }, 10);

            // Observer for Center "Snap" & Haptics
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        // Element is in the center
                        entry.target.style.opacity = '1';
                        entry.target.style.color = '#fff';
                        entry.target.style.transform = 'scale(1.1)';
                        haptic('light'); // Tick feel
                        
                        // Update State
                        const val = parseInt(entry.target.dataset.val);
                        if (type === 'met') {
                            if (id.includes('day')) state.metDate.day = val;
                            if (id.includes('month')) state.metDate.month = val;
                            if (id.includes('year')) state.metDate.year = val;
                        } else {
                            if (id.includes('day')) state.proposeDate.day = val;
                            if (id.includes('month')) state.proposeDate.month = val;
                            if (id.includes('year')) state.proposeDate.year = val;
                        }
                    } else {
                        entry.target.style.opacity = '0.3';
                        entry.target.style.color = 'rgba(255,255,255,0.3)';
                        entry.target.style.transform = 'scale(1)';
                    }
                });
            }, {
                root: container,
                threshold: 0.6, // Trigger when 60% visible (mostly center)
                rootMargin: "-45% 0px -45% 0px" // Narrow band in the middle
            });

            container.querySelectorAll('.picker-item').forEach(el => observer.observe(el));
        };

        // ==================== RENDERER ====================
        const render = () => {
            const app = document.getElementById('app');
            let content = '';

            // --- PAGE 0: LOCK SCREEN ---
            if (state.page === 0) {
                content = `
                    <div class="flex flex-col items-center justify-center min-h-screen px-6">
                        <div class="glass w-full max-w-sm rounded-3xl p-8 animate-fade-in-up flex flex-col items-center gap-8">
                            <div class="w-12 h-12 rounded-full bg-white/10 flex items-center justify-center animate-pulse-slow">
                                <svg class="w-6 h-6 text-white/70" fill="currentColor" viewBox="0 0 24 24"><path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2z"/></svg>
                            </div>
                            <div class="text-center">
                                <h2 class="text-lg font-light text-white/50 tracking-[0.2em] mb-2 uppercase">Passcode</h2>
                                <div class="relative">
                                    <input type="password" id="passInput" inputmode="numeric" maxlength="4" 
                                        class="bg-transparent border-b border-white/20 w-48 text-center text-4xl tracking-[0.5em] py-2 focus:outline-none focus:border-rose-500 transition-colors text-white font-light placeholder-white/10"
                                        placeholder="••••">
                                </div>
                            </div>
                            <button id="unlockBtn" class="glass-button w-full py-4 rounded-xl text-white/80 font-light tracking-wide hover:bg-white/10">
                                UNLOCK
                            </button>
                        </div>
                    </div>`;
            }

            // --- PAGE 1 & 2: DATE PICKERS ---
            else if (state.page === 1 || state.page === 2) {
                const isMet = state.page === 1;
                content = `
                    <div class="flex flex-col items-center justify-center min-h-screen relative overflow-hidden">
                        <h2 class="text-2xl font-light text-white/80 mb-12 animate-fade-in-up tracking-wide">
                            ${isMet ? 'When did we meet?' : 'When did I propose?'}
                        </h2>
                        
                        <div class="flex gap-4 mb-12 animate-fade-in-up" style="animation-delay: 0.1s">
                            <div class="w-20 text-center">
                                <div class="text-xs text-white/40 mb-2 uppercase tracking-widest">Day</div>
                                <div id="p-day" class="picker-container glass rounded-xl"></div>
                            </div>
                            <div class="w-20 text-center">
                                <div class="text-xs text-white/40 mb-2 uppercase tracking-widest">Month</div>
                                <div id="p-month" class="picker-container glass rounded-xl"></div>
                            </div>
                            <div class="w-24 text-center">
                                <div class="text-xs text-white/40 mb-2 uppercase tracking-widest">Year</div>
                                <div id="p-year" class="picker-container glass rounded-xl"></div>
                            </div>
                            
                            <div class="absolute top-[50%] left-0 w-full h-[50px] -translate-y-[20px] bg-white/5 pointer-events-none z-0 border-y border-white/10"></div>
                        </div>

                        <button id="dateNext" class="glass-button rounded-full p-4 animate-fade-in-up" style="animation-delay: 0.2s">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
                        </button>
                    </div>`;
            }

            // --- PAGE 3: NAME REVEAL ---
            else if (state.page === 3) {
                content = `
                    <div class="flex flex-col items-center justify-center min-h-screen">
                        <h1 class="text-6xl md:text-8xl font-[100] tracking-[0.2em] animate-fade-in-up text-white/90">RAIYA</h1>
                        <button onclick="transition(4)" class="mt-16 glass-button rounded-full p-4 opacity-50 hover:opacity-100 transition-opacity">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
                        </button>
                    </div>`;
            }

            // --- PAGE 4 & 5: HEARTBEAT ---
            else if (state.page === 4 || state.page === 5) {
                const isRacing = state.page === 5;
                content = `
                    <div class="flex flex-col items-center justify-center min-h-screen">
                        <div class="absolute top-10 right-10 glass px-4 py-2 rounded-full flex items-center gap-3 animate-fade-in-up">
                            <span class="text-red-500 animate-pulse">❤</span>
                            <span class="font-mono font-light text-sm"><span id="bpm-display">${isRacing ? '72' : '72'}</span> BPM</span>
                        </div>
                        
                        ${!isRacing ? `
                            <div class="mb-8 relative animate-fade-in-up">
                                <div class="w-64 h-40 bg-gray-800 rounded-2xl overflow-hidden border border-white/10 shadow-2xl shadow-red-500/20">
                                    <img src="assets/eyes.jpg" class="w-full h-full object-cover opacity-80" alt="Eyes">
                                </div>
                                <p class="text-center mt-6 text-xl font-light text-rose-300">When I see your eyes...</p>
                            </div>
                        ` : `
                            <p class="text-center mb-8 text-2xl font-light text-rose-500 animate-pulse-slow">My heart races...</p>
                        `}

                        <div id="${isRacing ? 'heartContainer2' : 'heartContainer'}" class="w-full h-[400px]"></div>

                        <button onclick="transition(${isRacing ? 6 : 5})" class="absolute bottom-12 glass-button rounded-full p-4">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
                        </button>
                    </div>`;
            }

            // --- PAGE 7: PROPOSAL ---
            else if (state.page === 7) {
                content = `
                    <div class="flex flex-col items-center justify-center min-h-screen px-4 text-center z-20 relative">
                        <h1 class="text-4xl md:text-5xl font-serif text-rose-100 mb-12 animate-fade-in-up">Will you be my Valentine?</h1>
                        <img src="https://media1.giphy.com/media/v1.Y2lkPTc5MGI3NjExbW5lenZyZHI5OXM2eW95b3pmMG40cWVrMDhtNjVuM3A4dGNxa2g2dSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9cw/VM1fcpu2bKs1e2Kdbj/giphy.gif" class="w-48 rounded-xl mb-12 opacity-90 animate-fade-in-up" style="animation-delay: 0.1s">
                        
                        <div class="flex flex-wrap justify-center gap-6 items-center animate-fade-in-up" style="animation-delay: 0.2s">
                            <button id="btnYes" class="glass-button bg-emerald-500/20 border-emerald-500/30 text-emerald-100 px-8 py-3 rounded-full text-xl transition-all" style="transform: scale(${1 + state.yesBtnSize * 0.1})">Yes</button>
                            <button id="btnNo" class="glass-button px-6 py-3 rounded-full text-white/50 hover:bg-red-500/10 hover:text-red-200 transition-colors">${state.noMsgIdx === 0 ? 'No' : noMessages[state.noMsgIdx % noMessages.length]}</button>
                        </div>
                    </div>`;
            }

            // --- PAGE 8: SUCCESS ---
            else if (state.page === 8) {
                content = `
                    <div class="flex flex-col items-center justify-center min-h-screen z-20 relative text-center">
                        <h1 class="text-4xl md:text-6xl font-light mb-8 animate-fade-in-up">I knew it! ❤️</h1>
                        <img src="https://media4.giphy.com/media/v1.Y2lkPTc5MGI3NjExMmo3c3l5ODh3ZGN6NHhhaDE2Mjg1ZjkwOXczdDFxbWM3dTBtaW9zaiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9cw/9XY4f3FgFTT4QlaYqa/giphy.gif" class="w-64 rounded-xl opacity-90 mb-12 animate-fade-in-up delay-100">
                        <button onclick="transition(10)" class="glass-button rounded-full p-4 animate-fade-in-up delay-200">
                             <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
                        </button>
                    </div>`;
            }

            // --- PAGE 10: LETTER ---
            else if (state.page === 10) {
                content = `
                    <div class="min-h-screen flex items-center justify-center p-8 bg-gradient-to-b from-black to-[#1a0505]">
                        <div class="max-w-2xl text-center">
                            <div id="typewriter" class="text-2xl md:text-3xl poetic-text leading-relaxed text-white/80 whitespace-pre-wrap min-h-[300px]"></div>
                        </div>
                    </div>`;
            }
            
            // Pass through for simple pages like 6
            else if (state.page === 6) {
                 content = `
                    <div class="flex flex-col items-center justify-center min-h-screen z-20 relative">
                        <h1 class="text-6xl tracking-[0.2em] font-[100] animate-pulse-slow">RAIYA</h1>
                         <button onclick="transition(7)" class="mt-20 glass-button rounded-full p-4">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
                        </button>
                    </div>`;
            }

            // Common Wrapper
            app.innerHTML = `<div id="main-content" class="transition-all duration-500 ease-out">${content}</div>`;

            // --- POST RENDER LISTENERS ---
            setTimeout(() => {
                if(state.page === 0) {
                    const inp = document.getElementById('passInput');
                    const btn = document.getElementById('unlockBtn');
                    inp?.focus();
                    inp?.addEventListener('keyup', (e) => {
                         state.password = e.target.value;
                         if(e.key === 'Enter') validatePass(); 
                    });
                    btn?.addEventListener('click', validatePass);
                }

                if(state.page === 1 || state.page === 2) {
                    const type = state.page === 1 ? 'met' : 'prop';
                    const initD = state.page === 1 ? state.metDate : state.proposeDate;
                    setupPicker('p-day', [1, 31], type, initD.day);
                    setupPicker('p-month', [1, 12], type, initD.month);
                    setupPicker('p-year', [2020, 2026], type, initD.year);
                    
                    document.getElementById('dateNext')?.addEventListener('click', () => {
                        const target = state.page === 1 ? state.correctMet : state.correctProp;
                        const current = state.page === 1 ? state.metDate : state.proposeDate;
                        
                        if(current.day === target.day && current.month === target.month && current.year === target.year) {
                            haptic('success');
                            transition(state.page + 1);
                        } else {
                            haptic('heavy');
                            alert('Try again love... think harder! ❤️');
                        }
                    });
                }

                if(state.page === 7) {
                    document.getElementById('btnYes').addEventListener('click', () => { haptic('success'); transition(8); });
                    document.getElementById('btnNo').addEventListener('click', () => {
                        haptic('medium');
                        state.yesBtnSize += 2;
                        state.noMsgIdx++;
                        render(); // Re-render to update button size
                    });
                }
            }, 50);
        };

        const validatePass = () => {
            if(state.password === '0102') {
                haptic('success');
                initAudio();
                transition(1);
            } else {
                haptic('heavy');
                document.getElementById('passInput').value = '';
                document.getElementById('passInput').classList.add('border-red-500');
                setTimeout(()=> document.getElementById('passInput').classList.remove('border-red-500'), 500);
            }
        };

        // ==================== VISUAL EFFECTS ====================
        
        // --- 3D HEART ---
        const initHeart = (isRacing, containerId) => {
             const container = document.getElementById(containerId);
             if(!container) return;
             
             const scene = new THREE.Scene();
             const camera = new THREE.PerspectiveCamera(75, container.clientWidth/container.clientHeight, 0.1, 1000);
             camera.position.z = 2.5;
             
             const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
             renderer.setSize(container.clientWidth, container.clientHeight);
             container.appendChild(renderer.domElement);
             
             // Simple Geometry Heart instead of FBX for reliability without external assets
             const x = 0, y = 0;
             const heartShape = new THREE.Shape();
             heartShape.moveTo( x + 0.5, y + 0.5 );
             heartShape.bezierCurveTo( x + 0.5, y + 0.5, x + 0.4, y, x, y );
             heartShape.bezierCurveTo( x - 0.6, y, x - 0.6, y + 0.7,x - 0.6, y + 0.7 );
             heartShape.bezierCurveTo( x - 0.6, y + 1.1, x - 0.3, y + 1.54, x + 0.5, y + 1.9 );
             heartShape.bezierCurveTo( x + 1.2, y + 1.54, x + 1.6, y + 1.1, x + 1.6, y + 0.7 );
             heartShape.bezierCurveTo( x + 1.6, y + 0.7, x + 1.6, y, x + 1.0, y );
             heartShape.bezierCurveTo( x + 0.7, y, x + 0.5, y + 0.5, x + 0.5, y + 0.5 );

             const geometry = new THREE.ExtrudeGeometry(heartShape, { depth: 0.4, bevelEnabled: true, bevelSegments: 2, steps: 2, bevelSize: 0.1, bevelThickness: 0.1 });
             const material = new THREE.MeshPhongMaterial({ color: 0xdc2626, shininess: 100 });
             const mesh = new THREE.Mesh(geometry, material);
             
             // Center geometry
             geometry.computeBoundingBox();
             const center = new THREE.Vector3();
             geometry.boundingBox.getCenter(center);
             mesh.position.sub(center);
             mesh.rotation.z = Math.PI; // Flip it upright
             
             scene.add(mesh);
             
             const light = new THREE.PointLight(0xffffff, 1, 100);
             light.position.set(10, 10, 10);
             scene.add(light);
             scene.add(new THREE.AmbientLight(0x404040));

             let scalePhase = 0;
             const animate = () => {
                 if(document.getElementById(containerId)) requestAnimationFrame(animate);
                 
                 const speed = isRacing ? 0.15 : 0.05;
                 scalePhase += speed;
                 const scale = 1 + Math.sin(scalePhase) * 0.1;
                 mesh.scale.set(scale, scale, scale);
                 mesh.rotation.y += 0.005;
                 
                 renderer.render(scene, camera);
             };
             animate();
        };

        // --- INFINITE HEARTS ---
        const initInfiniteHearts = () => {
            const canvas = document.createElement('canvas');
            canvas.id = 'heartsCanvas';
            document.body.prepend(canvas);
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            const ctx = canvas.getContext('2d');
            const hearts = [];
            
            for(let i=0; i<50; i++) hearts.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                speed: 0.5 + Math.random(),
                size: 5 + Math.random() * 15,
                color: `hsla(${340 + Math.random()*20}, 80%, 60%, ${0.1 + Math.random()*0.4})`
            });

            const anim = () => {
                if(state.page !== 6) { canvas.remove(); return; }
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                hearts.forEach(h => {
                    h.y -= h.speed;
                    if(h.y < -20) h.y = canvas.height + 20;
                    ctx.fillStyle = h.color;
                    ctx.font = `${h.size}px serif`;
                    ctx.fillText('❤', h.x, h.y);
                });
                requestAnimationFrame(anim);
            };
            anim();
        };

        // --- TYPEWRITER ---
        const typeWriter = () => {
            const el = document.getElementById('typewriter');
            if(!el) return;
            
            let fullText = shayariLines.join('\n');
            let idx = 0;
            
            const interval = setInterval(() => {
                el.textContent = fullText.slice(0, idx);
                idx++;
                haptic('light'); // Subtle typing feel
                if(idx > fullText.length) clearInterval(interval);
            }, 70);
        };

        // --- FIREWORKS ---
        const initFireworks = () => {
            const canvas = document.createElement('canvas');
            canvas.id = 'fireworksCanvas';
            document.body.prepend(canvas);
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            const ctx = canvas.getContext('2d');
            
            let particles = [];
            
            const createBurst = (x, y) => {
                for(let i=0; i<30; i++) {
                    particles.push({
                        x, y,
                        vx: (Math.random() - 0.5) * 10,
                        vy: (Math.random() - 0.5) * 10,
                        life: 1,
                        color: `hsl(${Math.random()*360}, 100%, 50%)`
                    });
                }
            };

            // Auto Burst
            const interval = setInterval(() => {
                if(state.page !== 8) clearInterval(interval);
                createBurst(Math.random()*canvas.width, Math.random()*canvas.height/2);
                haptic('medium');
            }, 800);

            const anim = () => {
                if(state.page !== 8) { canvas.remove(); return; }
                ctx.fillStyle = 'rgba(0,0,0,0.1)';
                ctx.fillRect(0,0,canvas.width, canvas.height);
                
                particles.forEach((p, i) => {
                    p.x += p.vx;
                    p.y += p.vy;
                    p.vy += 0.1; // gravity
                    p.life -= 0.02;
                    ctx.globalAlpha = p.life;
                    ctx.fillStyle = p.color;
                    ctx.fillRect(p.x, p.y, 3, 3);
                });
                particles = particles.filter(p => p.life > 0);
                requestAnimationFrame(anim);
            };
            anim();
        };

        // Start
        render();

    </script>
</body>
</html>
